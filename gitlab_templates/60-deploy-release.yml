deploy-release-assfire-router:
  only:
    - tags
  when: manual
  variables:
    HELM_EXPERIMENTAL_OCI: 1
  tags:
    - assfire-deployment-node
  stage:
    deploy_release
  script:
    - echo "Deploying Assfire Router"
    - helm registry login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY
    - helm chart pull $CI_REGISTRY/assfire/assfire-suite/helm/assfire-router:$APPLICATION_VERSION
    - helm chart export $CI_REGISTRY/assfire/assfire-suite/helm/assfire-router:$APPLICATION_VERSION
    - helm upgrade -i assfire-router -n assfire ./assfire-router
  dependencies:
    - publish-docker-assfire-router-server
    - publish-docker-assfire-router-maptest
    - build-helm-chart-assfire-router
  needs:
    - publish-docker-assfire-router-server
    - publish-docker-assfire-router-maptest
    - build-helm-chart-assfire-router