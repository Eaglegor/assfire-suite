.run-routes-provider-redis-cache-integration-tests-base:
  stage: run_integration_tests
  services:
    - redis:6.0.5
  script:
    - cd out
    - ./install/assfire-router/bin/assfire-router --bind-address=0.0.0.0:50051 --redis-cache-enabled --redis-host redis &
    - ctest -R integration-routes-provider-redis-cache

run-routes-provider-redis-cache-integration-tests-master:
  image: $CI_REGISTRY/assfire/assfire-suite/buildimage:latest
  extends: .run-routes-provider-redis-cache-integration-tests-base
  dependencies: 
    - build-project-master
  only:
    refs:
      - master
      - tags
  needs:
    - build-project-master

run-routes-provider-redis-cache-integration-tests-branch:
  image: $CI_REGISTRY/assfire/assfire-suite/buildimage:$CI_COMMIT_REF_SLUG-tmp
  extends: .run-routes-provider-redis-cache-integration-tests-base
  dependencies: 
    - build-project-branch
  only:
    refs:
      - branches
      - merge_requests
  needs:
    - build-project-branch